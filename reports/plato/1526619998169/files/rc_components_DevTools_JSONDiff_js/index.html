<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - rc/components/DevTools/JSONDiff.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>rc/components/DevTools/JSONDiff.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">69.12</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">128</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">45.38</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.04</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">import React, { PureComponent } from &#039;react&#039;;
import JSONTree from &#039;react-json-tree&#039;;
import stringify from &#039;javascript-stringify&#039;;
import getItemString from &#039;./getItemString&#039;;
import getJsonTreeTheme from &#039;./getJsonTreeTheme&#039;;

import { LabelRenderer } from &#039;react-json-tree&#039;;
import { Delta, ArrayDelta } from &#039;jsondiffpatch&#039;;
import { StylingFunction, Base16Theme, StylingConfig } from &#039;react-base16-styling&#039;;

function stringifyAndShrink(val, isWideLayout) {
  if (val === null) { return &#039;null&#039;; }

  const str = stringify(val);
  if (typeof str === &#039;undefined&#039;) { return &#039;undefined&#039;; }

  if (isWideLayout) return str.length &gt; 42 ? str.substr(0, 30) + &#039;…&#039; + str.substr(-10) : str;
  return str.length &gt; 22 ? `${str.substr(0, 15)}…${str.substr(-5)}` : str;
}

const expandFirstLevel = (keyName, data, level) =&gt; level &lt;= 1;

function prepareDelta(value) {
  if (value &amp;&amp; value._t === &#039;a&#039;) {
    const arrayDelta: ArrayDelta = (value: any);
    const res = {};
    for (let key in arrayDelta) {
      if (key !== &#039;_t&#039;) {
        if (key[0] === &#039;_&#039; &amp;&amp; !arrayDelta[key.substr(1)]) {
          res[key.substr(1)] = arrayDelta[key];
        } else if (arrayDelta[&#039;_&#039; + key]) {
          res[key] = [arrayDelta[&#039;_&#039; + key][0], arrayDelta[key][0]];
        } else if (!arrayDelta[&#039;_&#039; + key] &amp;&amp; key[0] !== &#039;_&#039;) {
          res[key] = arrayDelta[key];
        }
      }
    }
    return res;
  }

  return value;
}

const getStateFromProps = props =&gt; ({
  theme: getJsonTreeTheme(props.base16Theme)
});

export default class JSONDiff extends PureComponent {
  constructor(props) {
    super(props);
    this.state = getStateFromProps(props);
  }

  componentWillReceiveProps(nextProps) {
    if (nextProps.base16Theme !== this.props.base16Theme) {
      this.setState(getStateFromProps(nextProps));
    }
  }

  render() {
    const { styling, labelRenderer, invertTheme, expandDiffs, delta } = this.props;

    if (!delta) {
      return (
        &lt;div {...styling(&#039;stateDiffEmpty&#039;)}&gt;
          (states are equal)
        &lt;/div&gt;
      );
    }

    return (
      &lt;JSONTree
        labelRenderer={labelRenderer}
        invertTheme={invertTheme}
        theme={this.state.theme}
        data={delta}
        getItemString={this.getItemString}
        valueRenderer={this.valueRenderer}
        postprocessValue={prepareDelta}
        isCustomNode={Array.isArray}
        shouldExpandNode={expandDiffs ? () =&gt; true : expandFirstLevel}
        hideRoot
      /&gt;
    );
  }

  valueRenderer = (raw, value) =&gt; {
    const { styling, isWideLayout } = this.props;

    function renderSpan(name, body) {
      return (
        &lt;span key={name} {...styling([&#039;diff&#039;, name])}&gt;{body}&lt;/span&gt;
      );
    }

    if (Array.isArray(value)) {
      switch (value.length) {
        case 1:
          return (
            &lt;span {...styling(&#039;diffWrap&#039;)}&gt;
              {renderSpan(&#039;diffAdd&#039;, stringifyAndShrink(value[0], isWideLayout))}
            &lt;/span&gt;
          );
        case 2:
          return (
            &lt;span {...styling(&#039;diffWrap&#039;)}&gt;
              {renderSpan(&#039;diffUpdateFrom&#039;, stringifyAndShrink(value[0], isWideLayout))}
              {renderSpan(&#039;diffUpdateArrow&#039;, &#039; =&gt; &#039;)}
              {renderSpan(&#039;diffUpdateTo&#039;, stringifyAndShrink(value[1], isWideLayout))}
            &lt;/span&gt;
          );
        case 3:
          return (
            &lt;span {...styling(&#039;diffWrap&#039;)}&gt;
              {renderSpan(&#039;diffRemove&#039;, stringifyAndShrink(value[0], isWideLayout))}
            &lt;/span&gt;
          );
      }
    }

    return raw;
  }

  getItemString = (type, data) =&gt; {
    return getItemString(this.props.styling, type, data, this.props.isWideLayout, true);
  };
}
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
