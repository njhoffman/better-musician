{"version":3,"sources":["src/store/auth/actions/email-sign-in.js"],"names":["emailSignInFormUpdate","emailSignInStart","emailSignInComplete","emailSignInError","emailSignIn","EMAIL_SIGN_IN_START","EMAIL_SIGN_IN_COMPLETE","EMAIL_SIGN_IN_ERROR","EMAIL_SIGN_IN_FORM_UPDATE","endpoint","key","value","type","user","errors","body","endpointKey","prevEndpointKey","currentEndpointKey","dispatch","headers","method","then","catch"],"mappings":";;;;;;;;;;;QAcgBA,qB,GAAAA,qB;QAGAC,gB,GAAAA,gB;QAGAC,mB,GAAAA,mB;QAGAC,gB,GAAAA,gB;QAGAC,W,GAAAA,W;;AA1BhB;;AAKA;;AACA;;AACA;;;;;;AAEO,IAAMC,oDAA4B,qBAAlC;AACA,IAAMC,0DAA4B,wBAAlC;AACA,IAAMC,oDAA4B,qBAAlC;AACA,IAAMC,gEAA4B,2BAAlC;;AAEA,SAASR,qBAAT,CAA+BS,QAA/B,EAAyCC,GAAzC,EAA8CC,KAA9C,EAAqD;AAC1D,SAAO,EAAEC,MAAMJ,yBAAR,EAAmCC,kBAAnC,EAA6CC,QAA7C,EAAkDC,YAAlD,EAAP;AACD;AACM,SAASV,gBAAT,CAA0BQ,QAA1B,EAAoC;AACzC,SAAO,EAAEG,MAAMP,mBAAR,EAA6BI,kBAA7B,EAAP;AACD;AACM,SAASP,mBAAT,CAA6BO,QAA7B,EAAuCI,IAAvC,EAA6C;AAClD,SAAO,EAAED,MAAMN,sBAAR,EAAgCO,UAAhC,EAAsCJ,kBAAtC,EAAP;AACD;AACM,SAASN,gBAAT,CAA0BM,QAA1B,EAAoCK,MAApC,EAA4C;AACjD,SAAO,EAAEF,MAAML,mBAAR,EAA6BO,cAA7B,EAAqCL,kBAArC,EAAP;AACD;AACM,SAASL,WAAT,CAAqBW,IAArB,EAA2BC,WAA3B,EAAwC;AAC7C,SAAO,oBAAY;AACjB;AACA,QAAIC,kBAAkB,4CAAtB;;AAEA;AACA,+CAAsBD,WAAtB;AACA,QAAIE,qBAAqB,4CAAzB;;AAEAC,aAAS,wCAAwBD,kBAAxB,CAAT;AACAC,aAASlB,iBAAiBiB,kBAAjB,CAAT;;AAEA,WAAO,qBAAM,uCAAkBA,kBAAlB,CAAN,EAA6C;AAClDE,eAAS;AACP,kBAAU,kBADH;AAEP,wBAAgB;AAFT,OADyC;AAKlDC,cAAQ,MAL0C;AAMlDN,YAAM,yBAAeA,IAAf;AAN4C,KAA7C,EAQJO,IARI,qCASJA,IATI,CASC,UAACT,IAAD;AAAA,aAAUM,SAASjB,oBAAoBgB,kBAApB,EAAwCL,IAAxC,CAAT,CAAV;AAAA,KATD,EAUJU,KAVI,CAUE,UAACT,MAAD,EAAY;AACjB;AACA,iDAAsBG,eAAtB;AACAE,eAAS,wCAAwBF,eAAxB,CAAT;AACAE,eAAShB,iBAAiBe,kBAAjB,EAAqCJ,MAArC,CAAT;AACA,YAAMA,MAAN;AACD,KAhBI,CAAP;AAiBD,GA5BD;AA6BD","file":"email-sign-in.js","sourceRoot":"/home/vagrant/projects/instrumental","sourcesContent":["import {\r\n  getEmailSignInUrl,\r\n  setCurrentEndpointKey,\r\n  getCurrentEndpointKey\r\n} from \"../utils/session-storage\";\r\nimport {storeCurrentEndpointKey} from \"./configure\";\r\nimport {parseResponse} from \"../utils/handle-fetch-response\";\r\nimport fetch from \"../utils/fetch\";\r\n\r\nexport const EMAIL_SIGN_IN_START       = \"EMAIL_SIGN_IN_START\";\r\nexport const EMAIL_SIGN_IN_COMPLETE    = \"EMAIL_SIGN_IN_COMPLETE\";\r\nexport const EMAIL_SIGN_IN_ERROR       = \"EMAIL_SIGN_IN_ERROR\";\r\nexport const EMAIL_SIGN_IN_FORM_UPDATE = \"EMAIL_SIGN_IN_FORM_UPDATE\";\r\n\r\nexport function emailSignInFormUpdate(endpoint, key, value) {\r\n  return { type: EMAIL_SIGN_IN_FORM_UPDATE, endpoint, key, value };\r\n}\r\nexport function emailSignInStart(endpoint) {\r\n  return { type: EMAIL_SIGN_IN_START, endpoint };\r\n}\r\nexport function emailSignInComplete(endpoint, user) {\r\n  return { type: EMAIL_SIGN_IN_COMPLETE, user, endpoint };\r\n}\r\nexport function emailSignInError(endpoint, errors) {\r\n  return { type: EMAIL_SIGN_IN_ERROR, errors, endpoint };\r\n}\r\nexport function emailSignIn(body, endpointKey) {\r\n  return dispatch => {\r\n    // save previous endpoint key in case of failure\r\n    var prevEndpointKey = getCurrentEndpointKey();\r\n\r\n    // necessary for fetch to recognize the response as an api request\r\n    setCurrentEndpointKey(endpointKey);\r\n    var currentEndpointKey = getCurrentEndpointKey();\r\n\r\n    dispatch(storeCurrentEndpointKey(currentEndpointKey));\r\n    dispatch(emailSignInStart(currentEndpointKey));\r\n\r\n    return fetch(getEmailSignInUrl(currentEndpointKey), {\r\n      headers: {\r\n        \"Accept\": \"application/json\",\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      method: \"post\",\r\n      body: JSON.stringify(body)\r\n    })\r\n      .then(parseResponse)\r\n      .then((user) => dispatch(emailSignInComplete(currentEndpointKey, user)))\r\n      .catch((errors) => {\r\n        // revert endpoint key to what it was before failed request\r\n        setCurrentEndpointKey(prevEndpointKey);\r\n        dispatch(storeCurrentEndpointKey(prevEndpointKey));\r\n        dispatch(emailSignInError(currentEndpointKey, errors));\r\n        throw errors;\r\n      });\r\n  };\r\n}\r\n"]}